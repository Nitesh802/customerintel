<div class="local_customerintel">
  <h3>{{#str}} intelligencedashboard, local_customerintel {{/str}}</h3>
  <div class="mb-3">
    <a class="btn btn-primary" href="{{runurl}}">{{#str}} newanalysisrun, local_customerintel {{/str}}</a>
    <a class="btn btn-secondary" href="{{reportsurl}}">{{#str}} viewreports, local_customerintel {{/str}}</a>
    <a class="btn btn-info" href="{{sourcesurl}}">{{#str}} managesources, local_customerintel {{/str}}</a>
    {{#canviewlogs}}
    <a class="btn btn-warning" href="{{logsurl}}">{{#str}} viewlogs, local_customerintel {{/str}}</a>
    {{/canviewlogs}}
  </div>
  <div class="d-flex gap-4 mb-3">
    <div><strong>{{queued}}</strong><div>{{#str}} queued, local_customerintel {{/str}}</div></div>
    <div><strong>{{running}}</strong><div>{{#str}} running, local_customerintel {{/str}}</div></div>
    <div><strong>{{completed}}</strong><div>{{#str}} completed, local_customerintel {{/str}}</div></div>
    <div><strong>{{failed}}</strong><div>{{#str}} failed, local_customerintel {{/str}}</div></div>
  </div>
  <div class="card mb-3">
    <div class="card-header">{{#str}} recentruns, local_customerintel {{/str}}</div>
    <div class="card-body">
      {{#runs}}
        <table class="table table-sm">
          <thead><tr><th>ID</th><th>{{#str}} customer, local_customerintel {{/str}}</th><th>{{#str}} target, local_customerintel {{/str}}</th><th>{{#str}} status, local_customerintel {{/str}}</th><th>{{#str}} started, local_customerintel {{/str}}</th><th>{{#str}} completed, local_customerintel {{/str}}</th><th>Actions</th></tr></thead>
          <tbody>
            {{#runs}}
            <tr>
              <td>{{id}}</td>
              <td>{{customername}}</td>
              <td>{{targetname}}</td>
              <td>{{status}}</td>
              <td>{{timestarted_h}}</td>
              <td>{{timecompleted_h}}</td>
              <td>
                {{#can_view_report}}
                  <a href="{{report_url}}" class="btn btn-sm btn-primary">
                    View Report
                    {{#is_processing}}
                      <span class="badge badge-info" style="margin-left: 5px;">
                        <span class="spinner-small"></span> In Progress
                      </span>
                    {{/is_processing}}
                  </a>
                {{/can_view_report}}
              </td>
            </tr>
            {{/runs}}
          </tbody>
        </table>
      {{/runs}}
      {{^runs}}
        <em>{{#str}} noruns, local_customerintel {{/str}}</em>
      {{/runs}}
    </div>
  </div>
</div>

<style>
/* M2 Task 0.2: Spinner for in-progress runs */
.spinner-small {
    display: inline-block;
    width: 12px;
    height: 12px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid #7FF6D3;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    vertical-align: middle;
    margin-right: 5px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>